# 1. 代码所在
在 code 文件夹的对应项目名称目录下

# 2. 相关依赖

- Express

- art-template
- express-art-template
- bootstrap 3.3.7

# 3. 起步

## 3.1 启动服务

```js
let express = require('express')

let app = express()

app.engine('html', require('express-art-template'));

// routes
app.get('/', function (req, res) {
    res.render('index.html', {
        name: 'Lemon'
    });
});


app.listen(3000, () => {
    console.dir('running on port 3000')
})
```

## 3.2 套用样式
使用的是 bootstrap 3.3.7 的一个样式，在对应项目中都有。

## 3.3 试用模板

app.js：

```js
// routes
app.get('/', function (req, res) {
    res.render('index.html', {
        fruits: [
            'apple',
            'banana',
            'pear',
            'bear'
        ]
    });
});
```

/view/index.js：

```html
<div class="row placeholders">
    {{each fruits}}
    <div class="col-xs-6 col-sm-3 placeholder">
        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="
             width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
        <h4> {{$value}} </h4>
        <span class="text-muted">Something else</span>
    </div>
    {{/each}}
</div>
```

显示正常，就进行下一步，替换列表。

## 3.4 动态列表显示

创建一个数据文件：db.json：

```json
{
    "students": [
        {"id":1, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":2, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":3, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":4, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":5, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":6, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"},
        {"id":7, "name":"Lemon", "gender": 0, "age": 18, "hobits": "basketball、lol"}
    ]
}
```

改造显示列表：

```html
<table class="table table-striped">
    <thead>
        <tr>
            <th>id</th>
            <th>姓名</th>
            <th>性别</th>
            <th>年龄</th>
            <th>爱好</th>
        </tr>
    </thead>
    <tbody>
        {{each students }}
        <tr>
            <td>{{ $value.id }}</td>
            <td>{{ $value.name }}</td>
            <td>{{ $value.gender }}</td>
            <td>{{ $value.age }}</td>
            <td>{{ $value.hobits }}</td>
        </tr>
        {{ /each }}
    </tbody>
</table>
```

app.js 中调用数据填入模板引擎：

```js
// routes
app.get('/', function (req, res) {
    // 使用了文件系统读到了数据
    fs.readFile('./db.json', 'utf-8', function (err, data) {
        if (err) {
            return res.status(500).send('Server error.')
        }
        res.render('index.html', {
            fruits: [
                'apple',
                'banana',
                'pear',
                'bear'
            ],
            // 拿到的是 string，所以要转义为对象
            students: JSON.parse(data).students
        });
    })    
});
```

# 4. 路由设计

| 请求方法 | 请求路径              | get 参数 | post 参数                  | 备注             |
| -------- | --------------------- | -------- | -------------------------- | ---------------- |
| GET      | /students             |          |                            | 渲染首页         |
| GET      | /students/add         |          |                            | 渲染添加学生页面 |
| POST     | /students             |          | name、age、gender、hobbies | 处理添加学生请求 |
| GET      | /students/edit?id=xxx |          |                            | 渲染编辑学生页面 |

